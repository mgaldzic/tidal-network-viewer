"use strict";angular.module("App",["ngCookies","ngResource","ngSanitize","ngRoute","ui.jq"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("App").controller("MainCtrl",["$scope",function(a){a.dropzoneConfig={init:function(){this.on("addedfile",function(b){var c=new FileReader;c.onload=function(){a.data=angular.fromJson(c.result),a.$apply()},c.readAsText(b)})},url:"/",autoProcessQueue:!1,error:function(a,b,c){console.log("Error! ",c)}},a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("App").controller("sgTidalLayoutCtrl",["$scope",function(a){function b(a,b,c,d,e,f,g,h){var i,j,k,l,m,n={x:null,y:null,onLine1:!1,onLine2:!1};return i=(h-f)*(c-a)-(g-e)*(d-b),0===i?n:(j=b-f,k=a-e,l=(g-e)*j-(h-f)*k,m=(c-a)*j-(d-b)*k,j=l/i,k=m/i,n.x=a+j*(c-a),n.y=b+j*(d-b),j>0&&1>j&&(n.onLine1=!0),k>0&&1>k&&(n.onLine2=!0),n)}a.nodeSize={width:80,height:30},a.spacer=15,a.getLineIntersectionWithRectangle=function(a,c){var d,e=[{x1:c.x1,y1:c.y1,x2:c.x1,y2:c.y2},{x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y1},{x1:c.x2,y1:c.y1,x2:c.x2,y2:c.y2},{x1:c.x1,y1:c.y2,x2:c.x2,y2:c.y2}];return _.each(e,function(c){if(!d){var e=b(a.x1,a.y1,a.x2,a.y2,c.x1,c.y1,c.x2,c.y2);e.onLine1&&e.onLine2&&(d=e)}}),d||(d={x:(c.x1+c.x2)/2,y:(c.y1+c.y2)/2}),d},a.mouseoverLink=function(a){console.log(a)},a.mouseleaveLink=function(a){console.log(a)},a.OPACITY={focused:1,unfocused:.1,normal:.6},a.mouseoverNode=function(b){b.opacity=a.OPACITY.focused,_.each(a.additionalData.groups,function(c){_.each(c.nodes,function(c){c.id!==b.id&&(c.opacity=a.OPACITY.unfocused)})}),_.each(a.additionalData.edges,function(c){c.source.id!==b.id&&c.target.id!==b.id?c.opacity=a.OPACITY.unfocused:(c.opacity=a.OPACITY.focused,c.target.opacity=a.OPACITY.focused,c.source.opacity=a.OPACITY.focused)}),console.log(b)},a.mouseleaveNode=function(){_.each(a.additionalData.groups,function(a){_.each(a.nodes,function(a){a.opacity=1})}),_.each(a.additionalData.edges,function(b){b.opacity=a.OPACITY.normal})}}]),angular.module("App").controller("sgTidalDataCtrl",["$scope","Default","$timeout",function(a,b,c){c(function(){a.$parent.data=b},500),a.$watch("$parent.data",function(b){if(b){var c=b;a.edges=_.map(c.edges,function(a){return{source:_.find(c.nodes,function(b){return b.id===a[0]}),target:_.find(c.nodes,function(b){return b.id===a[1]})}});var d=c.timeSlots;a.groups=[];var e=0;_.each(d,function(b,d){var f=_.filter(c.nodes,function(a){return _.contains(b,a.id)});_.each(f,function(a){a.group=e});var g=_.filter(a.edges,function(a){return _.contains(b,a.source.id)&&_.contains(b,a.target.id)});a.forceLayout(f,[],{bounds:{w:800,h:500},size:30}),a.groups.push({nodes:f,links:g,name:d}),e+=1}),a.additionalData={groups:a.groups,edges:a.edges}}})}]),angular.module("App").directive("sgNodegraph",["$http","$templateCache","$compile",function(a,b,c){return{restrict:"E",scope:{ngModel:"=?",sbmlUrl:"@?",jsonUrl:"@?",template:"@",nodes:"=?",links:"=?",params:"=?",linkDistance:"=?",charge:"=?",gravity:"=?",height:"=?",width:"=?",scale:"=?",force:"=?",svg:"=?",translate:"=?",forceLayout:"=?",additionalData:"=?"},link:function(d,e){function f(f){a.get(f,{cache:b}).success(function(a){e.children().remove(),e.append(c(a)(d)),h()})}function g(){d.scale=d3.event.scale,d.translate.x=d3.event.translate[0],d.translate.y=d3.event.translate[1],d.$digest()}function h(){d.zoom&&d3.select(e.find("svg")[0]).call(j),d.svg=e}f(d.template),_&&(d._=_);var i=["links","nodes"];_.each(i,function(a){d.$watchCollection(a,function(a){a&&d.forceLayout(d.nodes,d.links,d.params)})}),d.translate={},d.scale=1;var j=d3.behavior.zoom().translate([0,0]).scale(1).scaleExtent([.5,8]).on("zoom",g);d.arrow=d3.svg.symbol().size(function(a){return a.size}).type(function(a){return a.type}),d.extendPoint=function(a,b,c){var d=Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2));return{x:b.x+(b.x-a.x)/d*c,y:b.y+(b.y-a.y)/d*c}},d.forceLayout=function(a,b,c){var e=d3.layout.force().charge(d.charge||-700).linkDistance(d.linkDistance||40).gravity(d.gravity||.1).size([d.width||800,d.height||800]);return _.each(a,function(a){a.force=e}),e.nodes(a).links(b).on("tick",function(){d.$digest(),c&&c.bounds&&_.each(a,function(a){a.x=Math.max(c.size,Math.min(c.bounds.w-c.size,a.x)),a.y=Math.max(c.size,Math.min(c.bounds.h-c.size,a.y))})}).start(),e}}}}]).directive("caseSensitive",function(){return{link:function(a,b,c){a.attr=c;var d=c.caseSensitive.split(",");angular.forEach(d,function(c){var d=c.toLowerCase();a.$watch("attr[lowercase]",function(){b[0].setAttribute(c,b[0].getAttribute(d))})})}}}).directive("draggable",["$document",function(a){return{link:function(b,c){function d(a){var d=c.scope().node;d.x=a.pageX/b.scale+f.x,d.y=a.pageY/b.scale+f.y,c.scope().$apply(),b.onDrag&&b.onDrag(a,d)}function e(){a.unbind("mousemove",d),a.unbind("mouseup",e)}var f={};c.css({position:"relative",border:"1px solid red",backgroundColor:"lightgrey",cursor:"pointer"}),c.on("mousedown",function(g){g.preventDefault(),g.stopPropagation(),f.x=c.scope().node.x-g.pageX/b.scale,f.y=c.scope().node.y-g.pageY/b.scale,a.on("mousemove",d),a.on("mouseup",e)})}}}]),angular.module("App").value("Default",{nodes:[{id:0,name:"FOSL1"},{id:1,name:"RELA"},{id:2,name:"RUNX3"},{id:3,name:"STAT4"},{id:4,name:"FOXC1"},{id:5,name:"REL"},{id:6,name:"FOXO3"},{id:7,name:"IRF9"},{id:8,name:"RELB"},{id:9,name:"NFKB1"},{id:10,name:"ALX1"},{id:11,name:"HBP1"},{id:12,name:"STAT3"},{id:13,name:"STAT1"},{id:14,name:"IRF8"},{id:15,name:"STAT2"},{id:16,name:"IRF2"},{id:17,name:"IRF1"},{id:18,name:"IRF7"}],edges:[[1,0],[2,0],[0,0],[0,3],[0,4],[5,6],[5,5],[5,7],[8,5],[9,5],[1,6],[10,6],[11,6],[6,6],[12,6],[3,6],[13,6],[4,6],[4,10],[14,4],[4,11],[6,4],[12,4],[13,4],[4,4],[11,11],[1,14],[15,14],[14,10],[14,11],[14,5],[2,14],[14,7],[12,14],[13,14],[4,14],[16,14],[9,14],[17,1],[15,17],[17,2],[17,7],[3,17],[13,17],[17,4],[17,16],[17,9],[16,1],[15,16],[16,2],[7,16],[3,16],[13,16],[16,4],[16,16],[16,9],[18,1],[18,15],[18,10],[18,11],[2,18],[18,7],[18,8],[18,13],[18,4],[18,16],[18,9],[1,7],[15,7],[2,7],[7,7],[13,7],[7,4],[16,7],[9,7],[13,1],[15,13],[13,10],[14,13],[17,13],[6,13],[2,13],[7,13],[12,13],[3,13],[13,13],[4,13],[16,13],[13,9],[15,1],[15,15],[15,10],[14,15],[17,15],[15,6],[2,15],[7,15],[12,15],[3,15],[13,15],[15,4],[16,15],[15,9],[1,1],[14,1],[1,11],[6,1],[1,5],[7,1],[0,1],[1,8],[1,12],[1,4],[1,9],[14,9],[9,11],[9,6],[5,9],[7,9],[8,9],[9,12],[9,4],[9,9],[18,2],[2,2],[5,8],[8,8],[8,12],[9,8],[15,12],[12,10],[14,12],[17,12],[6,12],[2,12],[12,7],[12,0],[12,12],[3,12],[13,12],[4,12],[16,12],[15,3],[3,10],[3,14],[17,3],[6,3],[2,3],[3,7],[12,3],[3,3],[13,3],[16,3]],timeSlots:{"8 hours":[2,18,16,17],"12 hours":[3,12,15,13,8,1,5,9,7,14,11,4,0,10],"16 hours":[6]}});